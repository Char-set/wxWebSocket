!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.wxWebSocket=t():e.wxWebSocket=t()}(this,(function(){return(()=>{"use strict";var e=[,(e,t,n)=>{function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ScoketEventName=void 0;var r,c,i=n(2);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y(this,n)}}function y(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(3),function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(r||(r={})),t.ScoketEventName=c,function(e){e.CONNECTING="connecting",e.ISOPEN="isopen",e.CLOSING="closing",e.CLOSED="closed"}(c||(t.ScoketEventName=c={}));var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(s,e);var t,n,o,i=p(s);function s(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(this,s),b(v(t=i.call(this)),"socket",void 0),b(v(t),"responseHeaders",{}),b(v(t),"readyState",void 0),b(v(t),"url",void 0),t.url=e,t.readyState=r.connecting,t.emit(c.CONNECTING),t.socket=wx.connectSocket({url:e,header:u({},o),protocols:Array.isArray(n)?n:[n]}),t}return t=s,n=[{key:"close",value:function(){var e=this;this.readyState=r.closing,this.emit(c.CLOSING),this.socket.close({code:1e3,reason:"normal closure",success:function(){e.readyState=r.closed,e.emit(c.CLOSED)}})}},{key:"onClose",value:function(e){var t=this;this.socket.onClose((function(n){e.call(t,n)}))}},{key:"onError",value:function(e){var t=this;this.socket.onError((function(n){e.call(t,n)}))}},{key:"onMessage",value:function(e){var t=this;this.socket.onMessage((function(n){try{var o=n.data;if(!o)return;var r=JSON.parse(o),c=r.biz;c?t.emit(c,r):e.call(t,n)}catch(o){console.error("解析socket返回失败",o),e.call(t,n)}}))}},{key:"onOpen",value:function(e){var t=this;this.socket.onOpen((function(n){for(var o in t.readyState=r.open,n.header)t.responseHeaders[o.toLowerCase()]=n.header[o];e.call(t,n)}))}},{key:"send",value:function(e){var t=this,n=this;return new Promise((function(o,r){var c=e.data,i=e.success,s=e.fail,u=e.complete;t.socket.send({data:JSON.stringify(c),success:function(e){i&&i.call(n,e),o(e)},fail:function(e){s&&s.call(n,e),r(e)},complete:function(){u&&u.call(n)}})}))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.socket.send({data:JSON.stringify(u({biz:e},t)),success:function(t){n&&n(),console.log("订阅业务 biz ：".concat(e," 成功 =>>>>>>>>>>>>>>"))},fail:function(t){console.log("订阅业务 biz ：".concat(e," 失败 =>>>>>>>>>>>>>>"))},complete:function(){}})}}],n&&f(t.prototype,n),o&&f(t,o),Object.defineProperty(t,"prototype",{writable:!1}),s}(i.EventEmitter);t.default=d},e=>{var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function c(e,t,o,c,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new r(o,c||e,i),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,c=o.length,i=new Array(c);r<c;r++)i[r]=o[r].fn;return i},s.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},s.prototype.emit=function(e,t,o,r,c,i){var s=n?n+e:e;if(!this._events[s])return!1;var u,a,f=this._events[s],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,o),!0;case 4:return f.fn.call(f.context,t,o,r),!0;case 5:return f.fn.call(f.context,t,o,r,c),!0;case 6:return f.fn.call(f.context,t,o,r,c,i),!0}for(a=1,u=new Array(l-1);a<l;a++)u[a-1]=arguments[a];f.fn.apply(f.context,u)}else{var p,y=f.length;for(a=0;a<y;a++)switch(f[a].once&&this.removeListener(e,f[a].fn,void 0,!0),l){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,t);break;case 3:f[a].fn.call(f[a].context,t,o);break;case 4:f[a].fn.call(f[a].context,t,o,r);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];f[a].fn.apply(f[a].context,u)}}return!0},s.prototype.on=function(e,t,n){return c(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return c(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,o,r){var c=n?n+e:e;if(!this._events[c])return this;if(!t)return i(this,c),this;var s=this._events[c];if(s.fn)s.fn!==t||r&&!s.once||o&&s.context!==o||i(this,c);else{for(var u=0,a=[],f=s.length;u<f;u++)(s[u].fn!==t||r&&!s[u].once||o&&s[u].context!==o)&&a.push(s[u]);a.length?this._events[c]=1===a.length?a[0]:a:i(this,c)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},()=>{}],t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{default:()=>e});const e=n(1).default})(),o=o.default})()}));